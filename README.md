# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Vite

Структура проекта:

- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:

- index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/main.ts — точка входа приложения
- src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск

Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run dev
```

или

```
yarn
yarn dev
```

## Сборка

```
npm run build
```

или

```
yarn build
```

# Интернет-магазин «Web-Larёk»

«Web-Larёk» — это интернет-магазин с товарами для веб-разработчиков, где пользователи могут просматривать товары, добавлять их в корзину и оформлять заказы. Сайт предоставляет удобный интерфейс с модальными окнами для просмотра деталей товаров, управления корзиной и выбора способа оплаты, обеспечивая полный цикл покупки с отправкой заказов на сервер.

## Архитектура приложения

Код приложения разделен на слои согласно парадигме MVP (Model-View-Presenter), которая обеспечивает четкое разделение ответственности между классами слоев Model и View. Каждый слой несет свой смысл и ответственность:

Model - слой данных, отвечает за хранение и изменение данных.  
View - слой представления, отвечает за отображение данных на странице.  
Presenter - презентер содержит основную логику приложения и отвечает за связь представления и данных.

Взаимодействие между классами обеспечивается использованием событийно-ориентированного подхода. Модели и Представления генерируют события при изменении данных или взаимодействии пользователя с приложением, а Презентер обрабатывает эти события используя методы как Моделей, так и Представлений.

### Базовый код

#### Класс Component

Является базовым классом для всех компонентов интерфейса.
Класс является дженериком и принимает в переменной `T` тип данных, которые могут быть переданы в метод `render` для отображения.

Конструктор:  
`constructor(container: HTMLElement)` - принимает ссылку на DOM элемент за отображение, которого он отвечает.

Поля класса:  
`container: HTMLElement` - поле для хранения корневого DOM элемента компонента.

Методы класса:  
`render(data?: Partial<T>): HTMLElement` - Главный метод класса. Он принимает данные, которые необходимо отобразить в интерфейсе, записывает эти данные в поля класса и возвращает ссылку на DOM-элемент. Предполагается, что в классах, которые будут наследоваться от `Component` будут реализованы сеттеры для полей с данными, которые будут вызываться в момент вызова `render` и записывать данные в необходимые DOM элементы.  
`setImage(element: HTMLImageElement, src: string, alt?: string): void` - утилитарный метод для модификации DOM-элементов `<img>`

#### Класс Api

Содержит в себе базовую логику отправки запросов.

Конструктор:  
`constructor(baseUrl: string, options: RequestInit = {})` - В конструктор передается базовый адрес сервера и опциональный объект с заголовками запросов.

Поля класса:  
`baseUrl: string` - базовый адрес сервера  
`options: RequestInit` - объект с заголовками, которые будут использованы для запросов.

Методы:  
`get(uri: string): Promise<object>` - выполняет GET запрос на переданный в параметрах ендпоинт и возвращает промис с объектом, которым ответил сервер  
`post(uri: string, data: object, method: ApiPostMethods = 'POST'): Promise<object>` - принимает объект с данными, которые будут переданы в JSON в теле запроса, и отправляет эти данные на ендпоинт переданный как параметр при вызове метода. По умолчанию выполняется `POST` запрос, но метод запроса может быть переопределен заданием третьего параметра при вызове.  
`handleResponse(response: Response): Promise<object>` - защищенный метод проверяющий ответ сервера на корректность и возвращающий объект с данными полученный от сервера или отклоненный промис, в случае некорректных данных.

#### Класс EventEmitter

Брокер событий реализует паттерн "Наблюдатель", позволяющий отправлять события и подписываться на события, происходящие в системе. Класс используется для связи слоя данных и представления.

Конструктор класса не принимает параметров.

Поля класса:  
`_events: Map<string | RegExp, Set<Function>>)` - хранит коллекцию подписок на события. Ключи коллекции - названия событий или регулярное выражение, значения - коллекция функций обработчиков, которые будут вызваны при срабатывании события.

Методы класса:  
`on<T extends object>(event: EventName, callback: (data: T) => void): void` - подписка на событие, принимает название события и функцию обработчик.  
`emit<T extends object>(event: string, data?: T): void` - инициализация события. При вызове события в метод передается название события и объект с данными, который будет использован как аргумент для вызова обработчика.  
`trigger<T extends object>(event: string, context?: Partial<T>): (data: T) => void` - возвращает функцию, при вызове которой инициализируется требуемое в параметрах событие с передачей в него данных из второго параметра.

### Данные

type TPayment = 'card' | 'cash' | ''; - Способ оплаты карта или наличные

Товар:
interface IProduct {
id: string; - Уникальный идентификатор товара.
description: string; - Подробное описание товара.
image: string; - URL или путь к изображению товара.
title: string; - Краткое название товара.
category: string; - Категория, к которой относится товар.
price: number | null; - Цена товара; может быть null, если товар бесплатный.
}
Покупатель:
interface IBuyer {
payment: TPayment; - Способ оплаты: card, cash или пустая строка, если не выбран.
email: string; - Электронная почта покупателя.
phone: string; - Телефон покупателя.
address: string; - Адрес доставки заказа.
}

### Модели данных

#### Класс ProductCatalogModel

Хранит массив всех товаров. Хранит товар, выбранный для подробного отображения.

Конструктор:  
`constructor()`

Поля класса:  
`_items: IProduct[]` - массив всех товаров.
`_selected: IProduct | null` — выбранный товар.

Методы класса:  
`getItems(): IProduct[]` — получить массив товаров из модели.
`setSelected(product: IProduct | null): void` — сохранить товар для подробного отображения.
`getById(id: string): IProduct | undefined` — получить один товар по его id.
`setItems(items: IProduct[]): void` — сохранить массив товаров полученного в параметрах метода.
`getSelected(): IProduct | null` — получить товар для подробного отображения.

#### Класс CartModel

Хранит массив товаров, выбранных покупателем для покупки.

Конструктор:  
`constructor()`

Поля класса:  
`_items: IProduct[]` - содержимое корзины.

Методы класса:  
`add(product: IProduct): void` — добавить товар, который был получен в параметре в массив корзины.
`remove(id: string): void` — удаление товара, полученного в параметре из массива корзины.
`getCount(): number` — получить количество товаров в корзине.
`getItems(): IProduct[]` — получить массив товаров, которые находятся в корзине.
`getTotal(): number` — получить стоимость всех товаров в корзине.
`has(id: string): boolean` — проверить наличие товара в корзине по его id, полученного в параметр метода.
`clear(): void` — очистить корзину.

#### Класс BuyerModel

Хранит следующие данные о покупателе (вид оплаты, адреc, телефон, email).

Конструктор:  
`constructor()`

Поля класса:  
`_payment: TPayment | null` — способ оплаты.
`_email: string` — e-mail.
`_phone: string` — телефон.
`_address: string` — адрес.

Методы класса:
`validate(): { valid: boolean; errors: Partial<Record<keyof IBuyer, string>> }` — валидация данных.
`getData(): IBuyer` — получение всех данных покупателя.
`setData(data: Partial<IBuyer>): void` - сохранение данных в модели. Один общий метод или отдельные методы для каждого поля.
`clear(): void` - очистка данных покупателя.

### Слой коммуникации

##### Класс LarekApi

Использует композицию, чтобы выполнить запрос на сервер с помощью метода get класса Api и получает с сервера объект с массивом товаров.

Конструктор:
`constructor(api: IApi)`

Поля:  
`private api: IApi`

Методы:
`getProducts(): Promise<IProduct[]>` — GET /product`- возвращает массив товаров.`createOrder(order: IOrderRequest): Promise<IOrderResponse>` — POST /order` - отправляет данные заказа.

### Слой Presenter

Для организации логики приложения используется отдельный слой Presenter.
Главный класс — AppPresenter (src/components/Presenter/AppPresenter.ts).

### Класс AppPresenter

Он отвечает за инициализацию, загрузку данных, подписку на события и связь между моделями (Catalog, Cart, Buyer) и вьюхами (CatalogView, CartView, ProductPreviewView, формы заказа и успеха), и слой коммуникации (Communication). Обеспечивает подписку на события и маршрутизацию данных между слоями.

Основные задачи:
Инициализация приложения

Загружает список товаров с сервера через Communication.
Передаёт данные в Catalog и CatalogView.
Обновляет счётчик корзины при старте.
Связь между слоями

Подписывается на события из Views через events.on.
Обновляет модели (Catalog, Cart, Buyer) на основе событий.
Управляет состоянием модалки (ModalView) для показа карточек, корзины и форм.
Обработка покупок

Добавление/удаление товаров из корзины.
Переход по шагам оформления заказа (оплата → контакты → подтверждение).
Отправка финального заказа на сервер и показ SuccessView.
Пример последовательности работы:

Пример использования:

import { AppPresenter } from './components/Presenter/AppPresenter';

const app = new AppPresenter();
app.init();

### Слой View

Отвечает за отрисовку интерфейса и генерацию событий.

### Класс CardView

Отвечает за отображение карточки товара в каталоге.
Генерирует событие card:select при клике.

### Класс CatalogView

Контейнер для списка карточек (CardView).
Используется для отрисовки каталога товаров.

### Класс CartView

Отвечает за отображение корзины: список товаров, общая сумма, кнопка оформления заказа.
Генерирует события cart:remove (удаление по индексу) и cart:order (переход к оформлению).

### Класс ProductPreviewView

Используется для отображения модалки с подробной информацией о товаре.
Генерирует событие cart:add при добавлении товара в корзину.

### Класс OrderFormView

Шаг 1 оформления заказа: выбор способа оплаты и ввод адреса.
Генерирует событие order:next.

### Класс ContactsFormView

Шаг 2 оформления заказа: ввод email и телефона.
Генерирует событие order:confirm.

### Класс ModalView

Универсальный контроллер модальных окон.
Управляет показом/скрытием, блокировкой скролла, генерирует события modal:open и modal:close.

### Класс SuccessView

Показывает результат успешного оформления заказа.
Генерирует событие success:close.
